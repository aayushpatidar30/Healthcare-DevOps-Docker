{% extends "base.html" %}
{% block title %}My Appointments - Eir Hospitals{% endblock %}
{% block content %}
<div class="card-health">
  <h1 class="hero-title">Your appointments</h1>
  <p class="hero-sub text-muted">View all scheduled appointments. Enter your Health ID below to see only yours.</p>

  <form method="get" action="{{ url_for('view_appointment') }}" style="margin-bottom:1.5rem;">
    <div class="form-group" style="margin-bottom:0.5rem;">
      <label for="health_id">Filter by Health ID (optional)</label>
      <input type="text" id="health_id" name="health_id" placeholder="e.g. p1234" value="{{ health_id_filter or '' }}">
    </div>
    <button type="submit" class="btn-health">Show my appointments</button>
    {% if health_id_filter %}
    <a href="{{ url_for('view_appointment') }}" class="btn-health btn-health-secondary" style="margin-left:0.5rem;">Show all</a>
    {% endif %}
  </form>

  {% if error %}
  <div class="msg-error">{{ error }}</div>
  {% endif %}

  {% if appointments %}
  <div style="overflow-x:auto;">
    <table class="table-health">
      <thead>
        <tr>
          <th>#</th>
          <th>Health ID</th>
          <th>Date</th>
          <th>Doctor</th>
          <th>Status</th>
          <th>Booked on</th>
        </tr>
      </thead>
      <tbody>
        {% for row in appointments %}
        <tr>
          <td>{{ row[0] }}</td>
          <td>{{ row[1] }}</td>
          <td>{{ row[2] }}</td>
          <td>{{ row[3] or '—' }}</td>
          <td><span style="color:{% if row[4] == 'scheduled' %}var(--primary){% else %}var(--text-muted){% endif %};">{{ row[4] }}</span></td>
          <td>{{ row[5][:10] if row[5] else '—' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <p class="text-muted" style="margin-top:0.75rem; font-size:0.9rem;">To cancel, go to Cancel Appointment and enter the same Health ID and date.</p>
  {% else %}
  <p class="text-muted">No appointments found. {% if health_id_filter %}Try removing the filter or book a new appointment.{% else %}Book an appointment from your dashboard.{% endif %}</p>
  {% endif %}

  <a href="{{ url_for('book_appointment') }}" class="btn-health mt-2">Book appointment</a>
  <a href="{{ url_for('main_page') }}" class="back-link mt-2">← Back to home</a>
</div>
{% endblock %}
